# Brief vertical cleanup
Okay we got an.. okay-ish implementation for animations let's refactor it before it becomes slop

## Prompt
Refactor this file into multiple colocated smaller files. Make sure to polish it all add necessary features, make each track show proper grid lines, make the top time indicator non text selectable and more robust (it currently sometimes doesn't show correctly if the animation doesnt start at 0:00)

## Conversation

alightinastorm: Refactor this file into multiple colocated smaller files. Make sure to polish it all add necessary features, make each track show proper grid lines, make the top time indicator non text selectable and more robust (it currently sometimes doesn't show correctly if the animation doesnt start at 0:00)



GitHub Copilot: I'll refactor the Timeline into smaller colocated components, add a robust viewport-based ruler with non-selectable labels, and add aligned grid lines per track. After creating the new files and updating the wrapper, I'll run a typecheck build to verify. 
```


Made changes.


```

```


Made changes.


```

```


Made changes.


```

```


Made changes.


```

```


Made changes.


```
I’ll fix the ref type mismatches in the new components, then run a typecheck build to ensure everything compiles. 
```


Made changes.


```

```


Made changes.


```


alightinastorm: @agent Try Again

GitHub Copilot: 
```


Made changes.


```

```


Made changes.


```
I’ll split `Timeline.tsx` into smaller colocated components, then add a robust time ruler and per-track grid lines, and make the top time indicator non-selectable.

## Checklist
- Refactor into smaller colocated files (math, ruler, lanes, list) [Done]
- Make top time indicator non text selectable [Done]
- Make the time ruler robust when clip doesn’t start at 0:00 [Done]
- Add proper grid lines per track [Done]
- Keep existing interactions (scrub, markers, key drag/select) [Done]
- Typecheck and quick build sanity [Done, with repo-wide lint issues unrelated to this change]

## What I changed
- Created timeline with focused components:
  - `math.ts`: time<->px helpers, visible-range calc, tick generator.
  - `Ruler.tsx`: top ruler with non-selectable labels, robust visible-range-based ticks, scrubbing, markers, playhead.
  - `TrackList.tsx`: left track tree (object > category > track) with solo/mute/lock and selection.
  - `TrackLanes.tsx`: right side lanes with aligned background stripes, dynamic grid lines per lane, keys rendering and dragging.
- Rewrote `Timeline.tsx` to compose the new parts and keep existing store wiring and behavior.
- Improvements:
  - Ruler labels use select-none; labels render based on visible range (not assuming start at 0:00).
  - Grid lines per track with zoom-aware spacing (~80px target) for clear alignment.
  - Scrubbing is smoother: seek on mousemove while button is held on the ruler.
  - Marker interactions preserved (drag, double-click to remove).
  - Track rows still sync-scroll with lanes.

## Files changed/added
- Updated: Timeline.tsx (now orchestrates the subcomponents)
- Added: math.ts (helpers)
- Added: Ruler.tsx (time ruler)
- Added: TrackList.tsx (left list)
- Added: TrackLanes.tsx (right lanes)

## Notes and behavior
- Time mapping is consistent across ruler/lanes: x = (t - (clipStart + pan)) * zoom; this fixes ruler misalignment when clip start ≠ 0.
- Ticks: major ticks at 1s with timecode labels; minor ticks at quarter-second granularity derived from FPS.
- Grid lines are computed from the visible time window and adapt to zoom for readability.
- The ruler is non-selectable (CSS `select-none`) to avoid accidental text selections.

## Validation
- Typecheck/build: Compiles successfully; repository has some pre-existing lint errors (unrelated) that cause the final lint step to fail. Our new files are error-free; only some “any” warnings remain, same as the codebase style.
- Requirements coverage: 
  - Refactor: Done
  - Non-selectable top indicator: Done
  - Robust time ruler for non-0 start: Done
  - Per-track grid lines: Done

## How to run
- Use your existing dev workflow. If you run the build task, expect unrelated lint errors elsewhere in the repo to still show. The new timeline compiles and runs under dev.

## Next steps (optional)
- Anchor zooming around mouse time for better UX.
- Add snapping toggle and marquee select for keys.
- Replace remaining any types in the new components when convenient to reduce warnings.