# Adding more default meshes

### Context: TopToolbar.tsx
Task: Add more default shapes, sphere, plane, cone, torus, cylinder, uv sphere
User Interactions:
- Instead of + Cube, it is a simple + Button that opens a menu of shapes that can be added
- For some shapes, the segment count is relevant, some might include multiple segmentation counts (plane has 2 segmentation counts, sphere only has one, etc.)
- Always provide defaults for every shape, after creation, show on the bottom center a subtle floating panel that allows to change the segments (with labels(!))
- Users can either press enter once after creation or click on X on the panel to discard the segmentation settings (and they never come back for this mesh)
State Management:
- as always, everything flows as much as possible through the zustand store!
Rendering:
- as far as the editor is concerned, EVERYTHING is just a mesh. Do not differentiate on the data layer too much between cubes or spheres
- always have correct face normals
- Make sure every shape is properly closed(!) do not leave the sphere open for example
Notes:
- Do NOT use threejs primitives such as cubegeometry, spheregeometry, etc. in this editor, everything is a buffergeometry!!
Sidequest:
- fix the seleection summary to look more subtle, calming soothing professional like the rest of the UI

------
I'll scan the geometry and store files to understand how meshes are created and how cube is implemented, so I can add new shape generators and UI accordingly.

Read geometryStore.ts

I'll read the geometry types and utilities to understand the Mesh shape structure, cube creation, and normals computation to implement other shapes consistently.

Read geometry.ts

Read geometry.ts

I'll scan scene and selection stores to wire mesh creation into scene objects and selection, matching how cube is added.

Read sceneStore.ts

Read selectionStore.ts

I'll scan the components to see where to wire a bottom-center floating panel and where the toolbar resides to add the shape menu.

Read components

Read EditorLayout.tsx

I'll scan the shortcut provider to see how to hook Enter and keybindings for dismissing the segmentation panel.

Read ShortcutProvider.tsx

I'll add shape generator utilities, a new shape creation store for the segmentation panel flow, extend the geometry store with creation actions, update the top toolbar to a '+' dropdown, add a bottom-center ShapeAdjustPanel, wire Enter to finalize, and restyle SelectionSummary.

geometry.ts+347-19
I'll extend the geometry store with more shape creation functions and a utility to replace mesh geometry, then add a new Zustand store to handle the shape creation/segment adjustment flow.

geometryStore.ts+77-1
Created shapeCreationStore.ts

shapeCreationStore.ts+5-5
Checkpoint: Added new geometry builders (plane, cylinder, cone, uv/ico sphere, torus) and store actions. Next I'll update the TopToolbar to replace the + Cube with a + dropdown, and add a floating ShapeAdjustPanel component and hook up shortcuts to finalize/cancel.

TopToolbar.tsx+40-6
Created ShapeAdjustPanel.tsx

Read EditorLayout.tsx

EditorLayout.tsx+6-0
SelectionSummary.tsx+16-33
Checked geometry.ts, geometryStore.ts, shapeCreationStore.ts, TopToolbar.tsx, EditorLayout.tsx, ShapeAdjustPanel.tsx, SelectionSummary.tsx, no problems found

Read tsconfig.json

TopToolbar.tsx+1-1
Read index.ts

geometry.ts+7-24
TopToolbar.tsx+10-1
TopToolbar.tsx+4-2
Checked TopToolbar.tsx, no problems found

shapeCreationStore.ts+3-6
geometry.ts+6-4
Checked geometry.ts, no problems found

I'll scan rendering components to verify whether face normals are used directly or recalculated, to decide if we must assign face.normal values.

Read EditorViewport.tsx

I’ll add the new shapes and UX flow you described, wire it through Zustand, and refresh the selection summary styling.

Checklist

Replace “+ Cube” with a “+ Add” menu of shapes
Add shapes: plane, cylinder, cone, torus, sphere, UV sphere
Segmentation defaults per shape; after creation show bottom-center floating panel to adjust segments with labels
Enter/X dismisses the panel; it doesn’t come back for that mesh
All state via Zustand; meshes only, no three primitives; closed shapes with correct outward face normals
Sidequest: make selection summary more subtle
actions taken

Geometry utilities

Added builders for shapes (quads/triangles as needed) with outward CCW face ordering and watertight caps:
Plane: width/height with widthSegments/heightSegments
Cylinder: radiusTop/radiusBottom, height, radialSegments, heightSegments, caps (closed)
Cone: via cylinder builder with radiusTop=0 (closed)
UV Sphere: widthSegments/heightSegments, closed at poles and seam
Ico Sphere: subdivisions
Torus: radialSegments/tubularSegments
Added helpers:
buildEdgesFromFaces to generate edges consistently
createMeshFromGeometry to build Mesh objects with calculated vertex normals
buildCubeGeometry and refactored createCubeMesh to use it
File: geometry.ts
Geometry store

New creation actions: createPlane, createCylinder, createCone, createUVSphere, createIcoSphere, createTorus
replaceGeometry(meshId, vertices, faces) to update an existing mesh while preserving the object
File: geometryStore.ts
Shape creation flow (Zustand)

New store to manage the temporary “adjust segmentation” UI state (active shape, params, finalize/cancel)
Defaults per shape; live updates call replaceGeometry
Enter finalizes; Esc or X cancels and closes the panel
File: shapeCreationStore.ts
UI

Top toolbar: replaced “+ Cube” with “+ Add” menu (Cube, Plane, Cylinder, Cone, UV Sphere, Sphere [icosphere], Torus)
Creation selects the new object and opens the segmentation panel
Click-outside closes menu
File: TopToolbar.tsx
Bottom-center floating segmentation panel with labeled inputs per shape
Cube: size
Plane: widthSegments, heightSegments
Cylinder: radialSegments, heightSegments
Cone: radialSegments, heightSegments
UV Sphere: widthSegments, heightSegments
Sphere (Ico): subdivisions
Torus: radialSegments, tubularSegments
Enter = Apply, X or Esc = dismiss
Mounted in the editor layout bottom-center
Files: src/components/ShapeAdjustPanel.tsx, EditorLayout.tsx
Sidequest (SelectionSummary)

Restyled to be subtler and more consistent; toned down borders and colors, compact typography
File: SelectionSummary.tsx
quality gates

Typecheck: PASS (no errors in updated files)
Build/run not executed here; types are consistent with project config
No behavioral changes to existing tools/workflows outside additions
notes

All shapes are generated as buffer-style data (vertices/edges/faces). No three.js primitive geometries are used.
Faces are ordered CCW for outward normals; the viewport computes flat normals per-triangle, yielding correct shading.
Everything flows through Zustand stores. The segmentation panel only shows right after creation and won’t reappear for existing meshes.
Try it

Open the “+ Add” menu in the top toolbar, choose a shape.
Adjust segments in the bottom-center panel; press Enter to apply or click X to discard.
Panel disappears after you finalize/cancel and won’t re-open for that mesh.
requirements coverage

Shapes added with defaults and segment controls: Done
“+ Add” menu UX: Done
Bottom-center panel with labels, Enter/X handling: Done
Zustand state usage: Done
Mesh-only data model, no three primitives: Done
Correct outward normals; watertight shapes: Done
Selection summary subtle styling: Done
If you want radius/size controls exposed in the panel too (not just segments), I can add them quickly.